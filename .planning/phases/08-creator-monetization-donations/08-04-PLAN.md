---
phase: 08-creator-monetization-donations
plan: 04
type: execute
wave: 2
depends_on: ["08-03"]
files_modified:
  - components/donate/tip-dialog.tsx
  - app/trade/[token]/page.tsx
  - app/(dashboard)/dashboard/creator/[id]/page.tsx
  - app/(dashboard)/dashboard/creator/earnings/page.tsx
autonomous: true

must_haves:
  truths:
    - "Viewer can open a tip dialog on a creator's trade page or profile"
    - "Viewer can send a SOL tip with a custom amount"
    - "Viewer can send a token tip with a custom amount"
    - "Tip history appears on the creator's earnings dashboard"
  artifacts:
    - path: "components/donate/tip-dialog.tsx"
      provides: "Reusable tip dialog component with SOL/token toggle"
      min_lines: 80
    - path: "app/trade/[token]/page.tsx"
      provides: "Trade page with tip button"
      contains: "TipDialog"
    - path: "app/(dashboard)/dashboard/creator/earnings/page.tsx"
      provides: "Earnings dashboard with tip history section"
      contains: "getDonationHistory"
  key_links:
    - from: "components/donate/tip-dialog.tsx"
      to: "app/trade/[token]/donate-actions.ts"
      via: "server action calls"
      pattern: "donateSol|donateToken"
    - from: "app/(dashboard)/dashboard/creator/earnings/page.tsx"
      to: "app/trade/[token]/donate-actions.ts"
      via: "getDonationHistory call"
      pattern: "getDonationHistory"
---

<objective>
Build the donation UI: a reusable tip dialog component for sending SOL and token tips, integrate it into the trade page and creator profile, and add tip history to the earnings dashboard.

Purpose: Viewers need a clear UI to support creators with tips. Creators need to see their tip history alongside other revenue streams.

Output: Tip dialog component, trade page + profile integration, earnings dashboard tip history section.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-creator-monetization-donations/08-RESEARCH.md
@.planning/phases/08-creator-monetization-donations/08-03-SUMMARY.md

@app/trade/[token]/donate-actions.ts (from 08-03: donateSol, donateToken, getDonationHistory)
@app/trade/[token]/page.tsx (trade page -- add tip button)
@app/(dashboard)/dashboard/creator/[id]/page.tsx (public creator profile -- add tip button)
@app/(dashboard)/dashboard/creator/earnings/page.tsx (from 08-01/08-02 -- add tip history section)
@components/ui/dialog.tsx (existing shadcn Dialog component)
@app/trade/[token]/trade-form.tsx (pattern: form with amount input, server action call, loading state, toast)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Tip dialog component</name>
  <files>components/donate/tip-dialog.tsx</files>
  <action>
Create a reusable `TipDialog` client component:

**Props:**
- `creatorName: string` -- for display
- `mintAddress: string` -- the creator's token mint
- `tokenTicker: string` -- e.g., "CRTR" for display
- `trigger?: React.ReactNode` -- optional custom trigger element (default: a "Tip" button)

**UI Structure:**
1. Uses shadcn Dialog (existing `components/ui/dialog.tsx`)
2. **Tab toggle** between "SOL" and "Token" tip modes (use simple button group, not shadcn Tabs -- keep it lightweight)
3. **Amount input**: Number input field. For SOL mode, show SOL symbol. For token mode, show token ticker.
4. **Preset amounts**: Quick-select buttons for common amounts (SOL: 0.01, 0.05, 0.1, 0.5 SOL; Token: 100, 500, 1000, 5000 tokens)
5. **Send Tip button**:
   - Shows loading state via `useTransition`
   - Calls `donateSol(mintAddress, amountInLamports)` or `donateToken(mintAddress, amountInRawTokens)` from donate-actions.ts
   - Convert SOL input to lamports: `BigInt(Math.floor(parseFloat(amount) * 1e9)).toString()`
   - Convert token input to raw: `BigInt(Math.floor(parseFloat(amount) * 1e6)).toString()` (assuming 6 decimals, same as SPL tokens created by the program)
   - On success: show sonner toast with "Tip sent!" + tx signature link, close dialog
   - On error: show sonner toast with error message

**Styling:**
- Match existing dialog styling from the unlock dialog / trade form patterns
- Use lucide-react `Heart` or `Gift` icon for the trigger button
- Keep the dialog compact (no unnecessary padding)
  </action>
  <verify>
Run `npx tsc --noEmit` -- no type errors. The component exports `TipDialog` as default or named export.
  </verify>
  <done>Reusable tip dialog supports both SOL and token tips with amount input, preset buttons, loading state, and toast feedback.</done>
</task>

<task type="auto">
  <name>Task 2: Integration into trade page, creator profile, and earnings history</name>
  <files>app/trade/[token]/page.tsx, app/(dashboard)/dashboard/creator/[id]/page.tsx, app/(dashboard)/dashboard/creator/earnings/page.tsx</files>
  <action>
**Trade page (app/trade/[token]/page.tsx):**
- Import `TipDialog` component
- Add it near the trade form area (below or beside the buy/sell form)
- Pass `creatorName`, `mintAddress`, and `tokenTicker` from the existing page data
- Only show the tip button if the viewer is NOT the creator (don't let creators tip themselves)

**Creator profile (app/(dashboard)/dashboard/creator/[id]/page.tsx):**
- Import `TipDialog` component
- Add a "Tip" button in the profile actions area (near the existing follow/share buttons or below the bio)
- Pass `creatorName`, `mintAddress`, and `tokenTicker` from the creator profile data
- Only show if the creator has a launched token (`mintAddress` exists)
- Only show if viewing another creator's profile (not your own)

**Earnings dashboard (app/(dashboard)/dashboard/creator/earnings/page.tsx):**
- Import `getDonationHistory` from donate-actions.ts
- Add a "Recent Tips" section below the existing revenue cards
- Call `getDonationHistory(mintAddress)` in the server component data fetch
- Render a simple list: sender name, amount (formatted), type (SOL/token icon), relative time
- If no tips yet, show "No tips received yet" placeholder
- Update the revenue breakdown section to include tip count and total tip amount (sum from donation table via a new SQL query in earnings-actions.ts -- add `getTipSummary(creatorProfileId)` that returns `{ solTotal: string, tokenTotal: string, count: number }`)
  </action>
  <verify>
Run `npx tsc --noEmit` -- no type errors. Visit a creator's trade page as a viewer -- "Tip" button is visible. Visit a creator's public profile -- "Tip" button is visible. Visit `/dashboard/creator/earnings` as a creator -- "Recent Tips" section is visible (may show empty state).
  </verify>
  <done>Tip dialog is accessible from trade page and creator profile. Earnings dashboard shows tip history and tip totals in the revenue breakdown.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` -- zero type errors
2. Trade page shows tip button for non-creator viewers
3. Creator profile shows tip button when token exists and viewer is not the creator
4. Tip dialog opens, allows SOL/token toggle, amount input, and preset amounts
5. Sending a tip calls the server action and shows toast feedback
6. Earnings dashboard shows "Recent Tips" section with donation history
7. Revenue breakdown includes tip totals
</verification>

<success_criteria>
- Viewer can tip a creator in SOL from the trade page or creator profile
- Viewer can tip a creator in their token from the trade page or creator profile
- Creator sees tip history and tip totals on their earnings dashboard
- Tip dialog provides clear UX: amount input, presets, loading state, success/error feedback
- Creator cannot tip themselves
</success_criteria>

<output>
After completion, create `.planning/phases/08-creator-monetization-donations/08-04-SUMMARY.md`
</output>
