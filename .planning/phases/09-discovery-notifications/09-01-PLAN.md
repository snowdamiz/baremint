---
phase: 09-discovery-notifications
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/db/schema.ts
  - lib/discovery/browse-actions.ts
  - app/(dashboard)/dashboard/page.tsx
  - components/discovery/creator-browse-card.tsx
autonomous: true

must_haves:
  truths:
    - "User sees a feed of real creators (not mock data) on the dashboard homepage"
    - "Only creators with launched tokens and approved KYC appear in the browse feed"
    - "Browse feed is paginated with load-more functionality"
  artifacts:
    - path: "lib/db/schema.ts"
      provides: "Optional category field on creatorProfile"
      contains: "category"
    - path: "lib/discovery/browse-actions.ts"
      provides: "Server action for paginated creator browse feed"
      exports: ["getCreatorBrowseFeed"]
    - path: "app/(dashboard)/dashboard/page.tsx"
      provides: "Dashboard homepage with real creator feed replacing mock data"
    - path: "components/discovery/creator-browse-card.tsx"
      provides: "Creator card component for browse feed"
  key_links:
    - from: "app/(dashboard)/dashboard/page.tsx"
      to: "lib/discovery/browse-actions.ts"
      via: "server action call"
      pattern: "getCreatorBrowseFeed"
    - from: "app/(dashboard)/dashboard/page.tsx"
      to: "components/discovery/creator-browse-card.tsx"
      via: "component import"
      pattern: "CreatorBrowseCard"
---

<objective>
Replace the mock data on the dashboard homepage with a real creator browse feed backed by database queries. Add an optional `category` field to `creatorProfile` for future filtering. Create a paginated server action that returns creators who have launched tokens and are KYC-approved, ordered by most recently active.

Purpose: Fulfills DISC-01 (user can browse creators on a homepage feed) and lays groundwork for DISC-02 (category field for search filtering).
Output: Working homepage feed showing real creators with token info, avatar, and bio.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-discovery-notifications/09-RESEARCH.md

Key existing files:
@lib/db/schema.ts — current schema with creatorProfile, creatorToken, trade tables
@app/(dashboard)/dashboard/page.tsx — current dashboard with mock feedPosts and suggestedCreators
@app/(dashboard)/layout.tsx — dashboard layout with sidebar nav (has Explore link to /dashboard/explore)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add category field to schema and create browse server action</name>
  <files>lib/db/schema.ts, lib/discovery/browse-actions.ts</files>
  <action>
1. In `lib/db/schema.ts`, add an optional `category` text column to `creatorProfile`:
   ```
   category: text("category"), // "Art" | "Music" | "Gaming" | "Education" | "Fitness" | "Tech" | "Other" | null
   ```
   Place it after `socialWebsite` and before `kycStatus`.

2. Create `lib/discovery/browse-actions.ts` with a `"use server"` directive:
   - `getCreatorBrowseFeed(limit: number = 20, offset: number = 0)` — Returns paginated creators with their token info
   - Query: INNER JOIN `creatorProfile` with `creatorToken` on `creatorToken.creatorProfileId = creatorProfile.id`
   - WHERE: `creatorProfile.kycStatus = 'approved'`
   - SELECT: id, displayName, bio, avatarUrl, category, mintAddress, tickerSymbol, tokenName, imageUrl (from creatorToken), createdAt
   - ORDER BY: `creatorProfile.createdAt DESC` (newest first for MVP)
   - Use `limit + 1` trick for hasMore pagination (fetch one extra, check length, slice to limit)
   - Return type: `{ creators: CreatorBrowseItem[], hasMore: boolean }`
   - Define `CreatorBrowseItem` type inline (exported) with all the selected fields

3. Run `npx drizzle-kit generate` to create the migration for the category column, then `npx drizzle-kit push` to apply.
  </action>
  <verify>
  - `npx drizzle-kit push` succeeds without errors
  - TypeScript compiles: `npx tsc --noEmit` passes (or at least no errors in modified files)
  </verify>
  <done>
  - creatorProfile table has optional category column
  - getCreatorBrowseFeed server action returns paginated creators with token info
  - Migration generated and applied
  </done>
</task>

<task type="auto">
  <name>Task 2: Replace mock dashboard feed with real creator browse</name>
  <files>app/(dashboard)/dashboard/page.tsx, components/discovery/creator-browse-card.tsx</files>
  <action>
1. Create `components/discovery/creator-browse-card.tsx`:
   - A card component that displays: creator avatar (or initial fallback), displayName, bio (truncated to 2 lines), category badge (if present), token ticker symbol and name, and a link to the creator's trade page (`/trade/${mintAddress}`)
   - Use existing card styling patterns from the codebase (rounded-xl border bg-card shadow-card)
   - Avatar: if avatarUrl exists, show `<img>` with rounded-full; otherwise show initial letter in a gradient circle (same pattern as current dashboard)
   - Category: small pill/badge if not null (e.g., `<span className="text-xs bg-muted px-2 py-0.5 rounded-full">`)
   - Token info: show ticker symbol with a small token icon if imageUrl exists
   - Make the entire card a Link to `/trade/${mintAddress}`

2. Rewrite `app/(dashboard)/dashboard/page.tsx`:
   - Remove ALL mock data (feedPosts, suggestedCreators arrays)
   - Keep the auth check and redirect
   - Import and call `getCreatorBrowseFeed` from `lib/discovery/browse-actions.ts` at the top of the server component
   - Render the welcome section (keep existing "Hey, {name}" greeting)
   - Render creator browse cards in a grid/list layout using `CreatorBrowseCard`
   - If hasMore is true, add a client component "Load More" button that fetches next page
   - For "Load More", create a small inline `"use client"` wrapper component at the bottom of the file (or separate file) that uses `useState` for offset and calls `getCreatorBrowseFeed` with increasing offset
   - If no creators found, show an empty state: "No creators yet. Be the first to launch a token!"
   - Remove the old `CreatorPost` and `CreatorCard` imports (these were mock UI components)
   - Keep the Account Section at the bottom with SignOutButton

3. Remove mock component imports that are no longer needed. The old `CreatorPost` and `CreatorCard` from `components/ui/` can be left in place (they may be used elsewhere or are untracked files).
  </action>
  <verify>
  - `npm run build` completes without errors
  - Dashboard page at `/dashboard` renders without mock data
  - If creators exist in DB, they appear; if not, empty state shows
  </verify>
  <done>
  - Dashboard homepage shows real creator browse feed from database
  - CreatorBrowseCard component renders creator info with link to trade page
  - Load more button works for pagination
  - No mock data remains on the dashboard page
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes without errors
2. Navigate to `/dashboard` — see real creators or empty state (no mock data)
3. If test creators exist: cards link to `/trade/{mintAddress}` correctly
4. Category field exists in creatorProfile schema
</verification>

<success_criteria>
- Dashboard homepage displays real creator data from the database (DISC-01)
- Mock data completely removed from dashboard page
- Pagination works via load-more button
- Category field added to creatorProfile for future use
</success_criteria>

<output>
After completion, create `.planning/phases/09-discovery-notifications/09-01-SUMMARY.md`
</output>
